import{u as B,r as p,c as w,D as S,o as J,E as T,b as s,e as n,t as _,j as F,i as f,w as l,G as g,F as k,h as V,v as r,d as L,g as N,H as C,I as D,B as I,l as i,q as P}from"./app-CBhZ9jHH.js";import{d as K}from"./dayjs.min-oW8S4DlB.js";const R={class:"content-header"},Y={class:"container-fluid"},E={class:"row mb-2"},H={class:"col-sm-6"},A={class:"m-0"},G={class:"content"},O={class:"container-fluid"},Q={class:"card"},$={class:"card-header"},z={class:"card-title"},W={class:"card-body"},X={key:0,class:"form-group"},Z={class:"form-group"},h=["value"],ee={key:1,class:"form-group"},ne=["value"],te={class:"form-group"},ae={class:"form-group"},oe={class:"form-group"},le={key:0,class:"form-group"},se={key:1,class:"form-group"},ie={class:"form-group"},ue={class:"form-group"},re={class:"form-group"},de={class:"form-group"},me={class:"form-group"},ve={class:"card-footer"},_e=["disabled"],ye={__name:"MaintenanceCreate",setup(pe){const U=T(),M=I(),d=B(),u=p("laporan"),b=p([]),q=p([]),c=p(!1),y=w(()=>d.isAdmin||d.isHead),x=w(()=>y.value&&u.value==="planning"?"Buat Jadwal Maintenance":"Laporkan Kerusakan"),t=p({inventory_id:"",pj_id:"",inspection_date:"",maintenance_frequency_type:"",maintenance_frequency_value:"",next_due_date:"",next_due_km:"",last_odometer_reading:"",issue_found:"",solution_taken:"",notes:"",cost:null});S(()=>[t.value.maintenance_frequency_type,t.value.maintenance_frequency_value,t.value.inspection_date],()=>{if(u.value!=="planning")return;const{maintenance_frequency_type:o,maintenance_frequency_value:e,inspection_date:m}=t.value;if(!o||!e||!m)return;const a=K(m);let v;o==="bulan"?v=a.add(e,"month"):o==="minggu"?v=a.add(e,"week"):o==="semester"&&(v=a.add(e*6,"month")),v&&(t.value.next_due_date=v.format("YYYY-MM-DD"))});const j=async()=>{const{inventory_id:o,inspection_date:e}=t.value;if(!o||!e){alert("Inventaris dan tanggal wajib diisi.");return}c.value=!0;try{const m={inspection_date:e,issue_found:t.value.issue_found,solution_taken:t.value.solution_taken,notes:t.value.notes,status:y.value&&u.value==="planning"?"on_progress":"reported",pj_id:u.value==="planning"?t.value.pj_id:null,cost:t.value.cost};await d.addMaintenanceRecord(o,m),y.value&&u.value==="planning"&&await d.scheduleInventory(o,{maintenance_frequency_type:t.value.maintenance_frequency_type,maintenance_frequency_value:t.value.maintenance_frequency_value,last_maintenance_at:e,next_due_date:t.value.next_due_date,next_due_km:t.value.next_due_km,last_odometer_reading:t.value.last_odometer_reading,pj_id:t.value.pj_id}),alert("Data berhasil disimpan."),M.push("/maintenance/needed")}catch(m){alert("Gagal menyimpan."),console.error(m)}finally{c.value=!1}};return J(async()=>{const o=Number(U.query.inventory);if(o){const{data:e}=await axios.get(`/inventories/${o}?with=item`);b.value=[e],t.value.inventory_id=o}else await d.fetchInventories({with:"item"}),b.value=d.inventories;await d.fetchUsersList("Umum"),q.value=d.usersList}),(o,e)=>{const m=D("router-link");return i(),s("div",null,[n("div",R,[n("div",Y,[n("div",E,[n("div",H,[n("h1",A,_(x.value),1)])])])]),n("div",G,[n("div",O,[n("div",Q,[n("div",$,[n("h3",z,_(x.value),1)]),n("form",{onSubmit:F(j,["prevent"])},[n("div",W,[y.value?(i(),s("div",X,[e[14]||(e[14]=n("label",null,"Jenis Form",-1)),l(n("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>u.value=a),class:"form-control"},e[13]||(e[13]=[n("option",{value:"laporan"},"Laporkan Kerusakan",-1),n("option",{value:"planning"},"Buat Jadwal Maintenance",-1)]),512),[[g,u.value]])])):f("",!0),n("div",Z,[e[15]||(e[15]=n("label",{for:"inventory_id"},"Inventaris",-1)),l(n("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.inventory_id=a),class:"form-control",required:""},[(i(!0),s(k,null,V(b.value,a=>{var v;return i(),s("option",{key:a.id,value:a.id},_(((v=a.item)==null?void 0:v.name)||"-")+" - "+_(a.inventory_number),9,h)}),128))],512),[[g,t.value.inventory_id]])]),u.value==="planning"?(i(),s("div",ee,[e[17]||(e[17]=n("label",{for:"pj_id"},"Penanggung Jawab (PJ)",-1)),l(n("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.pj_id=a),class:"form-control",required:""},[e[16]||(e[16]=n("option",{value:""},"-- Pilih PJ --",-1)),(i(!0),s(k,null,V(q.value,a=>(i(),s("option",{key:a.id,value:a.id},_(a.name)+" ("+_(a.divisi)+") ",9,ne))),128))],512),[[g,t.value.pj_id]])])):f("",!0),n("div",te,[e[18]||(e[18]=n("label",{for:"inspection_date"},"Tanggal",-1)),l(n("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=a=>t.value.inspection_date=a),class:"form-control",required:""},null,512),[[r,t.value.inspection_date]])]),u.value==="planning"?(i(),s(k,{key:2},[n("div",ae,[e[20]||(e[20]=n("label",{for:"maintenance_frequency_type"},"Frekuensi",-1)),l(n("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.maintenance_frequency_type=a),class:"form-control"},e[19]||(e[19]=[L('<option value="">-- Pilih --</option><option value="bulan">Bulan</option><option value="minggu">Minggu</option><option value="semester">Semester</option><option value="km">KM</option>',5)]),512),[[g,t.value.maintenance_frequency_type]])]),n("div",oe,[e[21]||(e[21]=n("label",{for:"maintenance_frequency_value"},"Nilai Frekuensi",-1)),l(n("input",{type:"number","onUpdate:modelValue":e[5]||(e[5]=a=>t.value.maintenance_frequency_value=a),class:"form-control"},null,512),[[r,t.value.maintenance_frequency_value]])]),t.value.maintenance_frequency_type!=="km"?(i(),s("div",le,[e[22]||(e[22]=n("label",{for:"next_due_date"},"Jatuh Tempo Berikutnya",-1)),l(n("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=a=>t.value.next_due_date=a),class:"form-control"},null,512),[[r,t.value.next_due_date]])])):f("",!0),t.value.maintenance_frequency_type==="km"?(i(),s("div",se,[e[23]||(e[23]=n("label",{for:"next_due_km"},"Jatuh Tempo (KM)",-1)),l(n("input",{type:"number","onUpdate:modelValue":e[7]||(e[7]=a=>t.value.next_due_km=a),class:"form-control"},null,512),[[r,t.value.next_due_km]])])):f("",!0),n("div",ie,[e[24]||(e[24]=n("label",{for:"last_odometer_reading"},"Odometer Terakhir",-1)),l(n("input",{type:"number","onUpdate:modelValue":e[8]||(e[8]=a=>t.value.last_odometer_reading=a),class:"form-control"},null,512),[[r,t.value.last_odometer_reading]])])],64)):f("",!0),n("div",ue,[e[25]||(e[25]=n("label",{for:"issue_found"},"Permasalahan",-1)),l(n("textarea",{"onUpdate:modelValue":e[9]||(e[9]=a=>t.value.issue_found=a),class:"form-control",rows:"3"},null,512),[[r,t.value.issue_found]])]),n("div",re,[e[26]||(e[26]=n("label",{for:"solution_taken"},"Solusi / Langkah",-1)),l(n("textarea",{"onUpdate:modelValue":e[10]||(e[10]=a=>t.value.solution_taken=a),class:"form-control",rows:"3"},null,512),[[r,t.value.solution_taken]])]),n("div",de,[e[27]||(e[27]=n("label",{for:"notes"},"Catatan Tambahan",-1)),l(n("textarea",{"onUpdate:modelValue":e[11]||(e[11]=a=>t.value.notes=a),class:"form-control",rows:"2"},null,512),[[r,t.value.notes]])]),n("div",me,[e[28]||(e[28]=n("label",{for:"cost"},"Estimasi Biaya (Rp)",-1)),l(n("input",{type:"number","onUpdate:modelValue":e[12]||(e[12]=a=>t.value.cost=a),class:"form-control",min:"0"},null,512),[[r,t.value.cost,void 0,{number:!0}]])])]),n("div",ve,[n("button",{type:"submit",class:"btn btn-primary",disabled:c.value},_(c.value?"Menyimpan...":"Simpan"),9,_e),N(m,{to:"/maintenance/list",class:"btn btn-secondary ml-2"},{default:C(()=>e[29]||(e[29]=[P("Batal",-1)])),_:1,__:[29]})])],32)])])])])}}};export{ye as default};
