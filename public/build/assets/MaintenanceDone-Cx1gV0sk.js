import{u as K,r as w,a as H,c as v,o as Q,b as o,e,g as L,H as T,I as W,i as c,w as k,v as M,f as g,G as X,F as b,h as I,n as j,j as _,t as u,k as Y,l,q as Z,J as ee}from"./app-CBhZ9jHH.js";const te={class:"content-header"},ae={class:"container-fluid"},se={class:"row mb-2"},ne={class:"col-sm-6"},le={class:"breadcrumb float-sm-right"},oe={class:"breadcrumb-item"},ie={class:"content"},re={class:"container-fluid"},de={class:"card"},ue={class:"card-body"},ce={class:"row"},me={class:"col-md-3 mb-2"},pe={class:"col-md-3 mb-2"},ve={class:"input-group"},ge={key:0,class:"col-md-3 mb-2"},fe=["value"],be={class:"card"},_e={class:"card-body"},ke={key:0,class:"text-center p-4"},he={key:1,class:"alert alert-info m-3"},ye={key:2},Pe={class:"table table-striped table-valign-middle"},Ce={key:0},xe={class:"pagination justify-content-center"},Se={class:"page-item"},we={key:0,class:"page-item disabled"},Te=["onClick"],Me={key:0,class:"page-item disabled"},Ie={class:"page-item"},J=2,Ne={__name:"MaintenanceDone",setup(je){const i=K(),h=w([]),y=w(!1),F=w([]),n=H({search:"",dateFrom:"",dateTo:"",pjId:""}),r=H({currentPage:1,perPage:10,total:0}),m=v(()=>r.currentPage),N=v(()=>r.perPage),d=v(()=>Math.max(1,Math.ceil(r.total/N))),P=v(()=>Math.max(1,m.value-J)),C=v(()=>Math.min(d.value,m.value+J)),R=v(()=>{const s=[];for(let t=P.value;t<=C.value;t++)s.push(t);return s}),z=async()=>{(i.isAdmin||i.isHead)&&(await i.fetchUsersList("Umum"),F.value=i.usersList)},f=async()=>{y.value=!0;try{const s=new URLSearchParams;s.set("per_page",r.perPage),s.set("page",r.currentPage),n.search&&s.set("search",n.search),n.dateFrom&&s.set("date_from",n.dateFrom),n.dateTo&&s.set("date_to",n.dateTo),n.pjId&&s.set("pj_id",n.pjId);const{data:t}=await Y.get(`${i.API_BASE_URL}/maintenance/done-datatable?${s}`,{headers:{Authorization:`Bearer ${i.token}`}});h.value=t.data,r.total=Number(t.recordsFiltered)}catch(s){console.error(s)}finally{y.value=!1}},E=s=>s?new Date(s).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}):"-",A=(()=>{let s;return()=>{clearTimeout(s),s=setTimeout(p,400)}})(),p=()=>{r.currentPage=1,f()},O=()=>{n.search="",n.dateFrom="",n.dateTo="",n.pjId="",p()},q=()=>{r.currentPage>1&&(r.currentPage--,f())},G=()=>{r.currentPage<d.value&&(r.currentPage++,f())},x=s=>{r.currentPage=s,f()};return Q(()=>{f(),(i.isAdmin||i.isHead)&&z()}),(s,t)=>{const S=W("router-link");return l(),o("div",null,[e("div",te,[e("div",ae,[e("div",se,[t[9]||(t[9]=e("div",{class:"col-sm-6"},[e("h1",{class:"m-0"},"Maintenance Selesai")],-1)),e("div",ne,[e("ol",le,[e("li",oe,[L(S,{to:"/dashboard"},{default:T(()=>t[7]||(t[7]=[Z("Home",-1)])),_:1,__:[7]})]),t[8]||(t[8]=e("li",{class:"breadcrumb-item active"},"Maintenance Selesai",-1))])])])])]),e("div",ie,[e("div",re,[e("div",de,[t[15]||(t[15]=e("div",{class:"card-header"},[e("h5",null,"Filter & Pencarian")],-1)),e("div",ue,[e("div",ce,[e("div",me,[t[10]||(t[10]=e("label",null,"Cari",-1)),k(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>n.search=a),onInput:t[1]||(t[1]=(...a)=>g(A)&&g(A)(...a)),class:"form-control",placeholder:"Nama barang / nomor inventaris"},null,544),[[M,n.search]])]),e("div",pe,[t[12]||(t[12]=e("label",null,"Rentang Tanggal",-1)),e("div",ve,[k(e("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=a=>n.dateFrom=a),class:"form-control",onChange:p},null,544),[[M,n.dateFrom]]),t[11]||(t[11]=e("div",{class:"input-group-prepend input-group-append"},[e("span",{class:"input-group-text"},"s/d")],-1)),k(e("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=a=>n.dateTo=a),class:"form-control",onChange:p},null,544),[[M,n.dateTo]])])]),g(i).isAdmin||g(i).isHead?(l(),o("div",ge,[t[14]||(t[14]=e("label",null,"Penanggung Jawab",-1)),k(e("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>n.pjId=a),class:"form-control",onChange:p},[t[13]||(t[13]=e("option",{value:""},"Semua PJ",-1)),(l(!0),o(b,null,I(F.value,a=>(l(),o("option",{key:a.id,value:a.id},u(a.name),9,fe))),128))],544),[[X,n.pjId]])])):c("",!0),e("div",{class:"col-md-3 mb-2 align-self-end d-flex gap-1"},[e("button",{class:"btn btn-primary w-50",onClick:p},"Terapkan"),e("button",{class:"btn btn-secondary w-50",onClick:O},"Reset")])])])]),e("div",be,[t[23]||(t[23]=e("div",{class:"card-header"},[e("h3",{class:"card-title"},"Daftar Maintenance Selesai")],-1)),e("div",_e,[y.value?(l(),o("div",ke,t[16]||(t[16]=[e("i",{class:"fas fa-spinner fa-spin fa-2x"},null,-1),e("p",{class:"mt-2"},"Memuat data...",-1)]))):h.value.length?(l(),o("div",ye,[e("table",Pe,[t[20]||(t[20]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"Nama Barang"),e("th",null,"Nomor Inventaris"),e("th",null,"Penanggung Jawab"),e("th",null,"Tanggal"),e("th",null,"Status"),e("th",null,"Aksi")])],-1)),e("tbody",null,[(l(!0),o(b,null,I(h.value,(a,B)=>{var D,U,V,$;return l(),o("tr",{key:a.id},[e("td",null,u((m.value-1)*N.value+B+1),1),e("td",null,u(((U=(D=a.inventory)==null?void 0:D.item)==null?void 0:U.name)||"-"),1),e("td",null,u(((V=a.inventory)==null?void 0:V.inventory_number)||"-"),1),e("td",null,u((($=a.responsible_person)==null?void 0:$.name)??"-"),1),e("td",null,u(E(a.inspection_date)),1),t[19]||(t[19]=e("td",null,[e("span",{class:"badge badge-success"},"Selesai")],-1)),e("td",null,[L(S,{to:`/maintenance/${a.id}`,class:"text-muted mr-2"},{default:T(()=>t[17]||(t[17]=[e("i",{class:"fas fa-eye"},null,-1)])),_:2,__:[17]},1032,["to"]),g(i).isAdmin||g(i).isHead?(l(),ee(S,{key:0,to:`/maintenance/edit/${a.id}`,class:"text-muted"},{default:T(()=>t[18]||(t[18]=[e("i",{class:"fas fa-edit"},null,-1)])),_:2,__:[18]},1032,["to"])):c("",!0)])])}),128))])]),d.value>1?(l(),o("nav",Ce,[e("ul",xe,[e("li",{class:j(["page-item",{disabled:m.value===1}])},[e("a",{class:"page-link",href:"#",onClick:_(q,["prevent"])},"Previous")],2),P.value>1?(l(),o(b,{key:0},[e("li",Se,[e("a",{class:"page-link",href:"#",onClick:t[5]||(t[5]=_(a=>x(1),["prevent"]))},"1")]),P.value>2?(l(),o("li",we,t[21]||(t[21]=[e("span",{class:"page-link"},"...",-1)]))):c("",!0)],64)):c("",!0),(l(!0),o(b,null,I(R.value,a=>(l(),o("li",{key:a,class:j(["page-item",{active:a===m.value}])},[e("a",{class:"page-link",href:"#",onClick:_(B=>x(a),["prevent"])},u(a),9,Te)],2))),128)),C.value<d.value?(l(),o(b,{key:1},[C.value<d.value-1?(l(),o("li",Me,t[22]||(t[22]=[e("span",{class:"page-link"},"...",-1)]))):c("",!0),e("li",Ie,[e("a",{class:"page-link",href:"#",onClick:t[6]||(t[6]=_(a=>x(d.value),["prevent"]))},u(d.value),1)])],64)):c("",!0),e("li",{class:j(["page-item",{disabled:m.value===d.value}])},[e("a",{class:"page-link",href:"#",onClick:_(G,["prevent"])},"Next")],2)])])):c("",!0)])):(l(),o("div",he," Belum ada maintenance yang selesai. "))])])])])])}}};export{Ne as default};
