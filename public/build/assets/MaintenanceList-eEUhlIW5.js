import{u as ee,r as A,a as V,c as f,o as te,b as o,e,g as H,H as M,I as ae,i as d,w as T,v as F,f as m,G as se,F as y,h as N,J as R,n as j,j as P,t as u,k as ne,l,q as E}from"./app-DjNxOoL9.js";const le={class:"content-header"},ie={class:"container-fluid"},oe={class:"row mb-2"},re={class:"col-sm-6"},de={class:"breadcrumb float-sm-right"},ue={class:"breadcrumb-item"},ce={class:"content"},me={class:"container-fluid"},pe={class:"card"},ge={class:"card-body"},ve={class:"row"},fe={class:"col-md-3 mb-2"},be={class:"col-md-3 mb-2"},ke={class:"input-group"},_e={key:0,class:"col-md-3 mb-2"},he=["value"],ye={class:"card"},Pe={class:"card-header d-flex justify-content-between align-items-center"},Ce={class:"card-body"},xe={key:0,class:"text-center p-4"},Me={key:1,class:"alert alert-info m-3"},Te={key:2},je={class:"table table-striped table-valign-middle"},Ie=["onClick"],we={key:0},De={class:"pagination justify-content-center"},Se={class:"page-item"},Ae={key:0,class:"page-item disabled"},Fe=["onClick"],Ne={key:0,class:"page-item disabled"},Ue={class:"page-item"},J=2,Ve={__name:"MaintenanceList",setup($e){const i=ee(),I=A([]),C=A(!1),U=A([]),n=V({search:"",dateFrom:"",dateTo:"",pjId:""}),r=V({currentPage:1,perPage:10,total:0}),g=f(()=>r.currentPage),$=f(()=>r.perPage),c=f(()=>Math.max(1,Math.ceil(r.total/$))),w=f(()=>Math.max(1,g.value-J)),D=f(()=>Math.min(c.value,g.value+J)),z=f(()=>{const s=[];for(let t=w.value;t<=D.value;t++)s.push(t);return s}),G=s=>({reported:"badge-danger",on_progress:"badge-warning",handled:"badge-info",done:"badge-success",cancelled:"badge-secondary"})[s]||"badge-light",O={reported:"Dilaporkan",on_progress:"Dalam Proses",handled:"Ditangani",done:"Selesai",cancelled:"Dibatalkan"},q=s=>s?new Date(s).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}):"-",Y=async()=>{(i.isAdmin||i.isHead)&&(await i.fetchUsersList("Umum"),U.value=i.usersList)},b=async()=>{C.value=!0;try{const s=new URLSearchParams;s.set("per_page",r.perPage),s.set("page",r.currentPage),n.search&&s.set("search",n.search),n.dateFrom&&s.set("date_from",n.dateFrom),n.dateTo&&s.set("date_to",n.dateTo),n.pjId&&s.set("pj_id",n.pjId);const{data:t}=await ne.get(`${i.API_BASE_URL}/maintenance/active-datatable?${s}`,{headers:{Authorization:`Bearer ${i.token}`}});I.value=t.data,r.total=Number(t.recordsFiltered),C.value=!1}catch(s){console.error(s),C.value=!1}},B=(()=>{let s;return()=>{clearTimeout(s),s=setTimeout(p,400)}})(),p=()=>{r.currentPage=1,b()},K=()=>{n.search="",n.dateFrom="",n.dateTo="",n.pjId="",p()},Q=()=>{r.currentPage>1&&(r.currentPage--,b())},W=()=>{r.currentPage<c.value&&(r.currentPage++,b())},S=s=>{r.currentPage=s,b()},X=async s=>{if(confirm("Yakin ingin menghapus maintenance yang dibatalkan ini?"))try{await i.deleteMaintenance(s),p()}catch(t){alert("Gagal menghapus: "+t.message)}};function Z(s){var _,h;const t=i.userRole,v=i.userDivisi,a=i.userId,x=s.user_id===a,k=((h=(_=s.inventory)==null?void 0:_.room)==null?void 0:h.pj_lokasi_id)===a;switch(s.status){case"reported":return["admin","head"].includes(t);case"on_progress":return t==="karyawan"&&v==="Umum"&&x||k;case"handled":return["admin","head"].includes(t)||k;default:return!1}}return te(()=>{b(),(i.isAdmin||i.isHead)&&Y()}),(s,t)=>{const v=ae("router-link");return l(),o("div",null,[e("div",le,[e("div",ie,[e("div",oe,[t[9]||(t[9]=e("div",{class:"col-sm-6"},[e("h1",{class:"m-0"},"Maintenance Aktif")],-1)),e("div",re,[e("ol",de,[e("li",ue,[H(v,{to:"/dashboard"},{default:M(()=>t[7]||(t[7]=[E("Home",-1)])),_:1,__:[7]})]),t[8]||(t[8]=e("li",{class:"breadcrumb-item active"},"Maintenance Aktif",-1))])])])])]),e("div",ce,[e("div",me,[e("div",pe,[t[15]||(t[15]=e("div",{class:"card-header"},[e("h5",null,"Filter & Pencarian")],-1)),e("div",ge,[e("div",ve,[e("div",fe,[t[10]||(t[10]=e("label",null,"Cari",-1)),T(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>n.search=a),onInput:t[1]||(t[1]=(...a)=>m(B)&&m(B)(...a)),class:"form-control",placeholder:"Nama barang / nomor inventaris"},null,544),[[F,n.search]])]),e("div",be,[t[12]||(t[12]=e("label",null,"Rentang Tanggal",-1)),e("div",ke,[T(e("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=a=>n.dateFrom=a),class:"form-control",onChange:p},null,544),[[F,n.dateFrom]]),t[11]||(t[11]=e("div",{class:"input-group-prepend input-group-append"},[e("span",{class:"input-group-text"},"s/d")],-1)),T(e("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=a=>n.dateTo=a),class:"form-control",onChange:p},null,544),[[F,n.dateTo]])])]),m(i).isAdmin||m(i).isHead?(l(),o("div",_e,[t[14]||(t[14]=e("label",null,"Penanggung Jawab",-1)),T(e("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>n.pjId=a),class:"form-control",onChange:p},[t[13]||(t[13]=e("option",{value:""},"Semua PJ",-1)),(l(!0),o(y,null,N(U.value,a=>(l(),o("option",{key:a.id,value:a.id},u(a.name),9,he))),128))],544),[[se,n.pjId]])])):d("",!0),e("div",{class:"col-md-3 mb-2 align-self-end d-flex gap-1"},[e("button",{class:"btn btn-primary w-50",onClick:p},"Terapkan"),e("button",{class:"btn btn-secondary w-50",onClick:K},"Reset")])])])]),e("div",ye,[e("div",Pe,[t[17]||(t[17]=e("h3",{class:"card-title"},"Daftar Maintenance Aktif",-1)),m(i).isAdmin||m(i).isHead?(l(),R(v,{key:0,to:"/maintenance/create",class:"btn btn-primary btn-sm"},{default:M(()=>t[16]||(t[16]=[e("i",{class:"fas fa-plus"},null,-1),E(" Tambah Maintenance ",-1)])),_:1,__:[16]})):d("",!0)]),e("div",Ce,[C.value?(l(),o("div",xe,t[18]||(t[18]=[e("i",{class:"fas fa-spinner fa-spin fa-2x"},null,-1),e("p",{class:"mt-2"},"Memuat data...",-1)]))):I.value.length?(l(),o("div",Te,[e("table",je,[t[22]||(t[22]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"Nama Barang"),e("th",null,"Nomor Inventaris"),e("th",null,"Penanggung Jawab"),e("th",null,"Tanggal"),e("th",null,"Status"),e("th",null,"Aksi")])],-1)),e("tbody",null,[(l(!0),o(y,null,N(I.value,(a,x)=>{var k,_,h,L;return l(),o("tr",{key:a.id},[e("td",null,u((g.value-1)*$.value+x+1),1),e("td",null,u(((_=(k=a.inventory)==null?void 0:k.item)==null?void 0:_.name)||"-"),1),e("td",null,u(((h=a.inventory)==null?void 0:h.inventory_number)||"-"),1),e("td",null,u(((L=a.responsible_person)==null?void 0:L.name)??"-"),1),e("td",null,u(q(a.inspection_date)),1),e("td",null,[e("span",{class:j(G(a.status))},u(O[a.status]||a.status),3)]),e("td",null,[H(v,{to:`/maintenance/${a.id}`,class:"text-muted mr-2"},{default:M(()=>t[19]||(t[19]=[e("i",{class:"fas fa-eye"},null,-1)])),_:2,__:[19]},1032,["to"]),Z(a)?(l(),R(v,{key:0,to:`/maintenance/edit/${a.id}`,class:"text-muted"},{default:M(()=>t[20]||(t[20]=[e("i",{class:"fas fa-edit"},null,-1)])),_:2,__:[20]},1032,["to"])):d("",!0),a.status==="cancelled"&&(m(i).isAdmin||m(i).isHead)?(l(),o("button",{key:1,class:"btn btn-sm btn-link text-danger",onClick:Be=>X(a.id)},t[21]||(t[21]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Ie)):d("",!0)])])}),128))])]),c.value>1?(l(),o("nav",we,[e("ul",De,[e("li",{class:j(["page-item",{disabled:g.value===1}])},[e("a",{class:"page-link",href:"#",onClick:P(Q,["prevent"])},"Previous")],2),w.value>1?(l(),o(y,{key:0},[e("li",Se,[e("a",{class:"page-link",href:"#",onClick:t[5]||(t[5]=P(a=>S(1),["prevent"]))},"1")]),w.value>2?(l(),o("li",Ae,t[23]||(t[23]=[e("span",{class:"page-link"},"...",-1)]))):d("",!0)],64)):d("",!0),(l(!0),o(y,null,N(z.value,a=>(l(),o("li",{key:a,class:j(["page-item",{active:a===g.value}])},[e("a",{class:"page-link",href:"#",onClick:P(x=>S(a),["prevent"])},u(a),9,Fe)],2))),128)),D.value<c.value?(l(),o(y,{key:1},[D.value<c.value-1?(l(),o("li",Ne,t[24]||(t[24]=[e("span",{class:"page-link"},"...",-1)]))):d("",!0),e("li",Ue,[e("a",{class:"page-link",href:"#",onClick:t[6]||(t[6]=P(a=>S(c.value),["prevent"]))},u(c.value),1)])],64)):d("",!0),e("li",{class:j(["page-item",{disabled:g.value===c.value}])},[e("a",{class:"page-link",href:"#",onClick:P(W,["prevent"])},"Next")],2)])])):d("",!0)])):(l(),o("div",Me," Belum ada maintenance aktif. "))])])])])])}}};export{Ve as default};
