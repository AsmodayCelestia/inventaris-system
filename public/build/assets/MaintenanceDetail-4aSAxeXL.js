import{y as Z,z as A,u as K,r as U,o as V,E as G,c as C,b as k,e,i as H,g as J,H as I,I as W,t as g,q as z,n as q,J as Q,F as X,h as tt,l as M}from"./app-CBhZ9jHH.js";import{r as et,d as F}from"./dayjs.min-oW8S4DlB.js";var R={exports:{}},st=R.exports,B;function nt(){return B||(B=1,function(T,L){(function(c,p){T.exports=p(et())})(st,function(c){function p(o){return o&&typeof o=="object"&&"default"in o?o:{default:o}}var x=p(c),a={name:"id",weekdays:"Minggu_Senin_Selasa_Rabu_Kamis_Jumat_Sabtu".split("_"),months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_November_Desember".split("_"),weekdaysShort:"Min_Sen_Sel_Rab_Kam_Jum_Sab".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Agt_Sep_Okt_Nov_Des".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sb".split("_"),weekStart:1,formats:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},relativeTime:{future:"dalam %s",past:"%s yang lalu",s:"beberapa detik",m:"semenit",mm:"%d menit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},ordinal:function(o){return o+"."}};return x.default.locale(a,null,!0),a})}(R)),R.exports}nt();var N={exports:{}},at=N.exports,E;function rt(){return E||(E=1,function(T,L){(function(c,p){T.exports=p()})(at,function(){var c="minute",p=/[+-]\d\d(?::?\d\d)?/g,x=/([+-]|\d\d)/g;return function(a,o,y){var f=o.prototype;y.utc=function(s){var i={date:s,utc:!0,args:arguments};return new o(i)},f.utc=function(s){var i=y(this.toDate(),{locale:this.$L,utc:!0});return s?i.add(this.utcOffset(),c):i},f.local=function(){return y(this.toDate(),{locale:this.$L,utc:!1})};var w=f.parse;f.parse=function(s){s.utc&&(this.$u=!0),this.$utils().u(s.$offset)||(this.$offset=s.$offset),w.call(this,s)};var S=f.init;f.init=function(){if(this.$u){var s=this.$d;this.$y=s.getUTCFullYear(),this.$M=s.getUTCMonth(),this.$D=s.getUTCDate(),this.$W=s.getUTCDay(),this.$H=s.getUTCHours(),this.$m=s.getUTCMinutes(),this.$s=s.getUTCSeconds(),this.$ms=s.getUTCMilliseconds()}else S.call(this)};var Y=f.utcOffset;f.utcOffset=function(s,i){var h=this.$utils().u;if(h(s))return this.$u?0:h(this.$offset)?Y.call(this):this.$offset;if(typeof s=="string"&&(s=function(l){l===void 0&&(l="");var _=l.match(p);if(!_)return null;var m=(""+_[0]).match(x)||["-",0,0],b=m[0],$=60*+m[1]+ +m[2];return $===0?0:b==="+"?$:-$}(s),s===null))return this;var n=Math.abs(s)<=16?60*s:s,t=this;if(i)return t.$offset=n,t.$u=s===0,t;if(s!==0){var r=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(t=this.local().add(n+r,c)).$offset=n,t.$x.$localOffset=r}else t=this.utc();return t};var d=f.format;f.format=function(s){var i=s||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return d.call(this,i)},f.valueOf=function(){var s=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*s},f.isUTC=function(){return!!this.$u},f.toISOString=function(){return this.toDate().toISOString()},f.toString=function(){return this.toDate().toUTCString()};var v=f.toDate;f.toDate=function(s){return s==="s"&&this.$offset?y(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():v.call(this)};var u=f.diff;f.diff=function(s,i,h){if(s&&this.$u===s.$u)return u.call(this,s,i,h);var n=this.local(),t=y(s).local();return u.call(n,t,i,h)}}})}(N)),N.exports}var it=rt();const ot=Z(it);var j={exports:{}},ut=j.exports,P;function lt(){return P||(P=1,function(T,L){(function(c,p){T.exports=p()})(ut,function(){var c={year:0,month:1,day:2,hour:3,minute:4,second:5},p={};return function(x,a,o){var y,f=function(d,v,u){u===void 0&&(u={});var s=new Date(d),i=function(h,n){n===void 0&&(n={});var t=n.timeZoneName||"short",r=h+"|"+t,l=p[r];return l||(l=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:h,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:t}),p[r]=l),l}(v,u);return i.formatToParts(s)},w=function(d,v){for(var u=f(d,v),s=[],i=0;i<u.length;i+=1){var h=u[i],n=h.type,t=h.value,r=c[n];r>=0&&(s[r]=parseInt(t,10))}var l=s[3],_=l===24?0:l,m=s[0]+"-"+s[1]+"-"+s[2]+" "+_+":"+s[4]+":"+s[5]+":000",b=+d;return(o.utc(m).valueOf()-(b-=b%1e3))/6e4},S=a.prototype;S.tz=function(d,v){d===void 0&&(d=y);var u,s=this.utcOffset(),i=this.toDate(),h=i.toLocaleString("en-US",{timeZone:d}),n=Math.round((i-new Date(h))/1e3/60),t=15*-Math.round(i.getTimezoneOffset()/15)-n;if(!Number(t))u=this.utcOffset(0,v);else if(u=o(h,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(t,!0),v){var r=u.utcOffset();u=u.add(s-r,"minute")}return u.$x.$timezone=d,u},S.offsetName=function(d){var v=this.$x.$timezone||o.tz.guess(),u=f(this.valueOf(),v,{timeZoneName:d}).find(function(s){return s.type.toLowerCase()==="timezonename"});return u&&u.value};var Y=S.startOf;S.startOf=function(d,v){if(!this.$x||!this.$x.$timezone)return Y.call(this,d,v);var u=o(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return Y.call(u,d,v).tz(this.$x.$timezone,!0)},o.tz=function(d,v,u){var s=u&&v,i=u||v||y,h=w(+o(),i);if(typeof d!="string")return o(d).tz(i);var n=function(_,m,b){var $=_-60*m*1e3,D=w($,b);if(m===D)return[$,m];var O=w($-=60*(D-m)*1e3,b);return D===O?[$,D]:[_-60*Math.min(D,O)*1e3,Math.max(D,O)]}(o.utc(d,s).valueOf(),h,i),t=n[0],r=n[1],l=o(t).utcOffset(r);return l.$x.$timezone=i,l},o.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},o.tz.setDefault=function(d){y=d}}})}(j)),j.exports}var dt=lt();const ct=Z(dt),ft={class:"content-header"},mt={class:"container-fluid"},vt={class:"row mb-2"},ht={class:"col-sm-6"},_t={class:"breadcrumb float-sm-right"},pt={class:"breadcrumb-item"},gt={class:"breadcrumb-item"},bt={class:"content"},yt={class:"container-fluid"},$t={key:0,class:"alert alert-danger m-3"},Mt={key:1,class:"text-center p-4"},kt={key:2,class:"alert alert-danger m-3"},Dt={key:3},xt={class:"card"},St={class:"card-header"},wt={class:"card-title"},Yt={class:"card-tools"},Tt={class:"card-body"},Ot={class:"table table-bordered"},zt={class:"mb-0"},Lt={class:"mb-0"},Ct={class:"mb-0"},Ut={class:"row"},Ht={class:"border rounded overflow-hidden"},It=["src","onClick"],Ft={class:"text-center p-1 text-muted"},Rt={key:0,class:"text-muted"},Nt={class:"card-footer"},jt=["src"],Jt={__name:"MaintenanceDetail",setup(T){F.locale("id"),F.extend(ot),F.extend(ct);const L=G(),c=K(),p=U(!0),x=U(null),a=U({}),o=U(null);V(async()=>{var n,t;try{a.value=await c.fetchMaintenanceDetail(L.params.id)}catch(r){x.value=((t=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:t.message)||"Gagal memuat data."}finally{p.value=!1}});const y=C(()=>{var m;if(a.value.status==="reported")return!0;if(!a.value.id)return!1;const{creator_id:n,inventory:t}=a.value,{userRole:r,userId:l,userDivisi:_}=c;return["admin","head"].includes(r)?!0:r==="karyawan"&&_==="Keuangan"?a.value.status==="done":n===l||r==="karyawan"&&_==="Umum"&&a.value.user_id===l||((m=t==null?void 0:t.room)==null?void 0:m.pj_lokasi_id)===l}),f=C(()=>{var m,b;if(a.value.status==="reported")return!0;if(!a.value.id)return!1;const n=a.value.status,t=c.userRole,r=c.userDivisi,l=a.value.user_id===c.userId,_=((b=(m=a.value.inventory)==null?void 0:m.room)==null?void 0:b.pj_lokasi_id)===c.userId;return["admin","head"].includes(t)?!0:t==="karyawan"&&r==="Umum"&&l?["on_progress","handled"].includes(n):!!(_&&["handled","on_progress"].includes(n))}),w=C(()=>a.value.status==="reported"&&a.value.user_id===null&&c.userRole==="karyawan"&&c.userDivisi==="Umum"),S=n=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n),Y=n=>({reported:"badge-danger",on_progress:"badge-warning",handled:"badge-info",done:"badge-success",cancelled:"badge-secondary"})[n]||"badge-light",d=C(()=>["photo_1","photo_2","photo_3"].map(n=>a.value[n]).filter(Boolean)),v=n=>n?F(n).format("DD MMMM YYYY"):"-",u=async()=>{var n,t;try{await c.assignMaintenance(a.value.id,{user_id:c.userId}),a.value=await c.fetchMaintenanceDetail(L.params.id)}catch(r){alert(((t=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:t.message)||"Gagal mengambil tugas")}},s=C(()=>{var l,_;const{status:n}=a.value,{userRole:t,userDivisi:r}=c;return t==="karyawan"&&r==="Keuangan"&&n==="done"?"/maintenance/done":t==="karyawan"&&r==="Umum"&n==="reported"?"/maintenance/needed":t==="karyawan"&&r==="Umum"&(n==="on_progress"||n==="handled")?"/maintenance/list":t==="karyawan"&&r==="Umum"&(n==="on_progress"||n==="done")?"/maintenance/done":(((_=(l=a.value.inventory)==null?void 0:l.room)==null?void 0:_.pj_lokasi_id)===c.userId&&(n==="on_progress"||n==="handled"),"/maintenance/list")}),i=n=>o.value=n,h=()=>o.value=null;return(n,t)=>{var l,_,m,b,$;const r=W("router-link");return M(),k("div",null,[e("div",ft,[e("div",mt,[e("div",vt,[t[3]||(t[3]=e("div",{class:"col-sm-6"},[e("h1",{class:"m-0"},"Detail Laporan Maintenance")],-1)),e("div",ht,[e("ol",_t,[e("li",pt,[J(r,{to:"/dashboard"},{default:I(()=>t[0]||(t[0]=[z("Home",-1)])),_:1,__:[0]})]),e("li",gt,[J(r,{to:"/maintenance/list"},{default:I(()=>t[1]||(t[1]=[z("Maintenance",-1)])),_:1,__:[1]})]),t[2]||(t[2]=e("li",{class:"breadcrumb-item active"},"Detail",-1))])])])])]),e("div",bt,[e("div",yt,[y.value?p.value?(M(),k("div",Mt,t[4]||(t[4]=[e("i",{class:"fas fa-spinner fa-spin fa-2x"},null,-1),e("p",{class:"mt-2"},"Memuat data...",-1)]))):x.value?(M(),k("div",kt,g(x.value),1)):(M(),k("div",Dt,[e("div",xt,[e("div",St,[e("h3",wt,[z(" Laporan #"+g(a.value.id||"-")+" ",1),e("span",{class:q(["ml-2 badge",Y(a.value.status)])},g(a.value.status_label||a.value.status),3)]),e("div",Yt,[w.value?(M(),k("button",{key:0,class:"btn btn-sm btn-primary mr-1",onClick:u},t[5]||(t[5]=[e("i",{class:"fas fa-hand-paper"},null,-1),z(" Ambil ",-1)]))):H("",!0),f.value?(M(),Q(r,{key:1,to:`/maintenance/edit/${a.value.id}`,class:"btn btn-sm btn-warning"},{default:I(()=>t[6]||(t[6]=[e("i",{class:"fas fa-edit"},null,-1),z(" Edit ",-1)])),_:1,__:[6]},8,["to"])):H("",!0)])]),e("div",Tt,[e("table",Ot,[e("tbody",null,[e("tr",null,[t[7]||(t[7]=e("th",{style:{width:"220px"}},"Inventaris",-1)),e("td",null,g(((_=(l=a.value.inventory)==null?void 0:l.item)==null?void 0:_.name)||"-")+" ("+g((m=a.value.inventory)==null?void 0:m.inventory_number)+")",1)]),e("tr",null,[t[8]||(t[8]=e("th",null,"Tanggal Pemeriksaan",-1)),e("td",null,g(v(a.value.inspection_date)),1)]),e("tr",null,[t[9]||(t[9]=e("th",null,"Status",-1)),e("td",null,[e("span",{class:q(Y(a.value.status))},g(a.value.status_label||a.value.status),3)])]),e("tr",null,[t[10]||(t[10]=e("th",null,"Permasalahan",-1)),e("td",null,[e("pre",zt,g(a.value.issue_found||"-"),1)])]),e("tr",null,[t[11]||(t[11]=e("th",null,"Solusi / Tindakan",-1)),e("td",null,[e("pre",Lt,g(a.value.solution_taken||"-"),1)])]),e("tr",null,[t[12]||(t[12]=e("th",null,"Catatan",-1)),e("td",null,[e("pre",Ct,g(a.value.notes||"-"),1)])]),e("tr",null,[t[13]||(t[13]=e("th",null,"Biaya",-1)),e("td",null,g(a.value.cost?S(a.value.cost):"-"),1)]),e("tr",null,[t[14]||(t[14]=e("th",null,"Teknisi / PJ",-1)),e("td",null,g(((b=a.value.responsible_person)==null?void 0:b.name)||"-"),1)]),e("tr",null,[t[15]||(t[15]=e("th",null,"Pembuat Laporan",-1)),e("td",null,g((($=a.value.creator)==null?void 0:$.name)||"-"),1)]),e("tr",null,[t[16]||(t[16]=e("th",null,"Odometer Terakhir",-1)),e("td",null,g(a.value.odometer_reading??"-"),1)])])]),t[17]||(t[17]=e("h5",{class:"mt-4 mb-2"},"Foto-foto",-1)),e("div",Ut,[(M(!0),k(X,null,tt(d.value,(D,O)=>(M(),k("div",{key:O,class:"col-md-4 mb-3"},[e("div",Ht,[e("img",{src:D,alt:"Foto",class:"img-fluid cursor-pointer",style:{"max-height":"200px",width:"100%","object-fit":"cover"},onClick:qt=>i(D)},null,8,It),e("div",Ft,"Foto "+g(O+1),1)])]))),128)),d.value.length?H("",!0):(M(),k("div",Rt,"Tidak ada foto."))])]),e("div",Nt,[J(r,{to:s.value,class:"btn btn-secondary"},{default:I(()=>t[18]||(t[18]=[e("i",{class:"fas fa-arrow-left"},null,-1),z(" Kembali ",-1)])),_:1,__:[18]},8,["to"])])])])):(M(),k("div",$t," Anda tidak memiliki hak akses ke laporan ini. "))])]),o.value?(M(),k("div",{key:0,class:"lightbox",onClick:h},[e("img",{src:o.value,alt:"Preview"},null,8,jt)])):H("",!0)])}}},Pt=A(Jt,[["__scopeId","data-v-3b79d546"]]);export{Pt as default};
